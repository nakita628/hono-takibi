openapi: 3.1.0
info:
  title: Extreme OpenAPI Features API
  version: 1.0.0
  summary: Testing all extreme OpenAPI 3.1 features
  description: |
    # Markdown Support in Description
    
    This API tests **extreme** OpenAPI features including:
    
    - Full markdown support
    - All info fields
    - All server configurations
    - Webhooks
    - Path items in components
    - JSON Schema 2020-12 features
    
    ## Code Examples
    
    ```javascript
    const api = new ExtremeAPI();
    api.call();
    ```
    
    | Feature | Status |
    |---------|--------|
    | Webhooks | ✓ |
    | PathItems | ✓ |
    | Callbacks | ✓ |
  termsOfService: https://example.com/terms
  contact:
    name: API Support
    url: https://example.com/support
    email: api-support@example.com
  license:
    name: Apache 2.0
    identifier: Apache-2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

jsonSchemaDialect: https://json-schema.org/draft/2020-12/schema

externalDocs:
  description: Full API Documentation
  url: https://docs.example.com

servers:
  - url: https://api.example.com/v{version}
    description: Production
    variables:
      version:
        default: '1'
        enum:
          - '1'
          - '2'
          - '3'
        description: API version
  - url: https://{region}.api.example.com/{basePath}
    description: Regional
    variables:
      region:
        default: us-east
        enum:
          - us-east
          - us-west
          - eu-west
          - eu-central
          - ap-northeast
          - ap-southeast
      basePath:
        default: v1
  - url: '{protocol}://{host}:{port}/{basePath}'
    description: Custom
    variables:
      protocol:
        default: https
        enum:
          - http
          - https
      host:
        default: localhost
      port:
        default: '8080'
      basePath:
        default: api

tags:
  - name: Core
    description: Core API operations
    externalDocs:
      url: https://docs.example.com/core
  - name: Advanced
    description: Advanced operations
  - name: Experimental
    description: Experimental features
  - name: Deprecated
    description: Deprecated operations
  - name: Internal
    description: Internal operations

paths:
  /items:
    $ref: '#/components/pathItems/ItemsResource'
  
  /items/{itemId}:
    $ref: '#/components/pathItems/SingleItemResource'
  
  /stream:
    get:
      operationId: streamData
      tags:
        - Advanced
      summary: Stream data with Server-Sent Events
      responses:
        '200':
          description: Event stream
          content:
            text/event-stream:
              schema:
                type: string
  
  /graphql:
    post:
      operationId: graphqlQuery
      tags:
        - Advanced
      summary: GraphQL endpoint
      requestBody:
        content:
          application/graphql:
            schema:
              type: string
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                variables:
                  type: object
                operationName:
                  type: string
      responses:
        '200':
          description: GraphQL response
          content:
            application/graphql+json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                  errors:
                    type: array
                    items:
                      type: object
  
  /grpc-gateway:
    post:
      operationId: grpcGateway
      tags:
        - Advanced
      summary: gRPC-Gateway endpoint
      requestBody:
        content:
          application/grpc:
            schema:
              type: string
              format: binary
          application/grpc+proto:
            schema:
              type: string
              format: binary
      responses:
        '200':
          description: gRPC response
          content:
            application/grpc:
              schema:
                type: string
                format: binary

  /deprecated-endpoint:
    get:
      operationId: deprecatedOperation
      deprecated: true
      tags:
        - Deprecated
      summary: This endpoint is deprecated
      description: |
        **DEPRECATED**: This endpoint will be removed in v3.
        
        Please use `/new-endpoint` instead.
      responses:
        '200':
          description: OK
          headers:
            Deprecation:
              schema:
                type: string
              description: Deprecation date
            Sunset:
              schema:
                type: string
              description: Removal date
            Link:
              schema:
                type: string
              description: Link to replacement

webhooks:
  itemCreated:
    post:
      operationId: onItemCreated
      tags:
        - Webhooks
      summary: Item created webhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemCreatedEvent'
      responses:
        '200':
          description: Webhook received
        '202':
          description: Webhook accepted for processing
  
  itemUpdated:
    post:
      operationId: onItemUpdated
      tags:
        - Webhooks
      summary: Item updated webhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemUpdatedEvent'
      responses:
        '200':
          description: OK
  
  itemDeleted:
    post:
      operationId: onItemDeleted
      tags:
        - Webhooks
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemDeletedEvent'
      responses:
        '200':
          description: OK
  
  batchEvent:
    post:
      operationId: onBatchEvent
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                oneOf:
                  - $ref: '#/components/schemas/ItemCreatedEvent'
                  - $ref: '#/components/schemas/ItemUpdatedEvent'
                  - $ref: '#/components/schemas/ItemDeletedEvent'
      responses:
        '200':
          description: OK

components:
  schemas:
    # JSON Schema 2020-12 features
    JsonSchema2020Features:
      $schema: https://json-schema.org/draft/2020-12/schema
      $id: https://example.com/schemas/features
      type: object
      properties:
        prefixItems:
          type: array
          prefixItems:
            - type: string
            - type: number
            - type: boolean
          items:
            type: 'null'
        unevaluatedItems:
          type: array
          prefixItems:
            - type: string
          unevaluatedItems: false
        unevaluatedProperties:
          type: object
          properties:
            known:
              type: string
          unevaluatedProperties: false
        dependentRequired:
          type: object
          properties:
            a:
              type: string
            b:
              type: string
          dependentRequired:
            a:
              - b
        dependentSchemas:
          type: object
          properties:
            creditCard:
              type: string
          dependentSchemas:
            creditCard:
              properties:
                billingAddress:
                  type: string
              required:
                - billingAddress
        propertyNames:
          type: object
          propertyNames:
            pattern: '^[a-z]+$'
        minContains:
          type: array
          contains:
            type: string
          minContains: 2
        maxContains:
          type: array
          contains:
            type: number
          maxContains: 5
        contentEncoding:
          type: string
          contentEncoding: base64
        contentMediaType:
          type: string
          contentMediaType: application/json
        contentSchema:
          type: string
          contentMediaType: application/json
          contentSchema:
            type: object
            properties:
              nested:
                type: string

    Item:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        metadata:
          type: object
          additionalProperties: true
      example:
        id: 550e8400-e29b-41d4-a716-446655440000
        name: Example Item
        description: An example item

    ItemCreatedEvent:
      type: object
      required:
        - event
        - data
        - timestamp
      properties:
        event:
          const: item.created
        data:
          $ref: '#/components/schemas/Item'
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object

    ItemUpdatedEvent:
      type: object
      required:
        - event
        - data
        - timestamp
      properties:
        event:
          const: item.updated
        data:
          $ref: '#/components/schemas/Item'
        previousData:
          $ref: '#/components/schemas/Item'
        timestamp:
          type: string
          format: date-time
        changedFields:
          type: array
          items:
            type: string

    ItemDeletedEvent:
      type: object
      required:
        - event
        - itemId
        - timestamp
      properties:
        event:
          const: item.deleted
        itemId:
          type: string
          format: uuid
        timestamp:
          type: string
          format: date-time

    # XML-specific features
    XmlFeatures:
      type: object
      xml:
        name: root
        namespace: http://example.com/schema
        prefix: ex
      properties:
        attribute:
          type: string
          xml:
            attribute: true
            name: attr
        wrapped:
          type: array
          xml:
            wrapped: true
            name: items
          items:
            type: string
            xml:
              name: item
        namespacedChild:
          type: object
          xml:
            namespace: http://example.com/child
            prefix: ch
          properties:
            value:
              type: string

    # Discriminator with mapping
    DiscriminatedUnion:
      oneOf:
        - $ref: '#/components/schemas/Dog'
        - $ref: '#/components/schemas/Cat'
        - $ref: '#/components/schemas/Bird'
      discriminator:
        propertyName: petType
        mapping:
          dog: '#/components/schemas/Dog'
          cat: '#/components/schemas/Cat'
          bird: '#/components/schemas/Bird'
          canine: '#/components/schemas/Dog'
          feline: '#/components/schemas/Cat'
          avian: '#/components/schemas/Bird'

    Pet:
      type: object
      required:
        - petType
        - name
      properties:
        petType:
          type: string
        name:
          type: string

    Dog:
      allOf:
        - $ref: '#/components/schemas/Pet'
        - type: object
          properties:
            petType:
              const: dog
            breed:
              type: string
            barkVolume:
              type: integer

    Cat:
      allOf:
        - $ref: '#/components/schemas/Pet'
        - type: object
          properties:
            petType:
              const: cat
            breed:
              type: string
            meowPitch:
              type: integer

    Bird:
      allOf:
        - $ref: '#/components/schemas/Pet'
        - type: object
          properties:
            petType:
              const: bird
            species:
              type: string
            canFly:
              type: boolean

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string

  pathItems:
    ItemsResource:
      summary: Items collection
      description: Operations on items collection
      get:
        operationId: listItems
        tags:
          - Core
        summary: List all items
        parameters:
          - $ref: '#/components/parameters/PageParam'
          - $ref: '#/components/parameters/LimitParam'
        responses:
          '200':
            description: Items list
            content:
              application/json:
                schema:
                  type: array
                  items:
                    $ref: '#/components/schemas/Item'
      post:
        operationId: createItem
        tags:
          - Core
        summary: Create an item
        requestBody:
          required: true
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        responses:
          '201':
            description: Created
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Item'
        callbacks:
          onItemCreated:
            '{$request.body#/callbackUrl}':
              post:
                requestBody:
                  content:
                    application/json:
                      schema:
                        $ref: '#/components/schemas/ItemCreatedEvent'
                responses:
                  '200':
                    description: OK

    SingleItemResource:
      summary: Single item operations
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      get:
        operationId: getItem
        tags:
          - Core
        summary: Get an item
        responses:
          '200':
            description: Item details
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Item'
          '404':
            description: Not found
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Error'
      put:
        operationId: updateItem
        tags:
          - Core
        summary: Update an item
        requestBody:
          required: true
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        responses:
          '200':
            description: Updated
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Item'
      delete:
        operationId: deleteItem
        tags:
          - Core
        summary: Delete an item
        responses:
          '204':
            description: Deleted

  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
    
    LimitParam:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    
    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []
